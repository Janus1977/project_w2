<?php
	/*
	 * AUTO-GENERATED FILE on 23/02/2017 14:20:59 BY FactoryGenerator.class.php
	 */

abstract class FactoryTile {

	/*
	 * Entre ces deux balises vous pourrez mettre votre code specifique a la classe.
	 * Il sera preserve lors de la reconstruction automatique.
	 */
	/*[TAG-Tile11]*/	/*[/TAG-Tile11]*/


	public static function getFromTableTile($id=-1) {
		//Generated by FactoryGenerator::generateGetAllFromTable()
		$listeObjet = array();
		// Lancement de la requete
		if (empty(self::$_requete)) {
			$requete = 'SELECT * FROM `tile`';
		} else {
			$requete = self::$_requete;
		}
		if (!is_array($id)) {
			if ($id > -1) {
				$requete .= ' WHERE id = :id';
				//Il faut que le parametre soit dans un array pour le BIND
				$id = array(':id' => $id);
			} else {
				/* Tous les objets ==> il faut les ordonner */
				$requete .= ' ORDER BY id ASC';
			}
		} else {
			$requete .= ' WHERE id IN ('.implode(",",$id).') ORDER BY id ASC';
		}
		database::getInstance() -> prepareRequete($requete);
		if (is_array($id) || $id > -1) {
			database::getInstance() -> bind($id);
		}
		if (! database::getInstance() -> executeRequete()) {
			throw new Exception(__CLASS__.'::'.__FUNCTION__.'(): Impossible de lire la table tile');
		}
		// Recuperation des donnees
		$datas = database::getInstance() -> getTableauResultat();
		
	/*
	 * Entre ces deux balises vous pourrez mettre votre code specifique a la classe.
	 * Il sera preserve lors de la reconstruction automatique.
	 */
	/*[TAG-Tile2]*/	/*[/TAG-Tile2]*/

		/* Traitement des donnees */
		foreach ($datas AS $data) {
			/* objet par defaut */
			$listeObjet[] = new Tile($data['id'],$data['carte'],$data['x'],$data['y'],$data['vision'],$data['unite'],$data['unite_joueur'],$data['decor'],$data['equipement'],$data['equipement_joueur'],$data['etatCase'],$data['bloque'],$data['tile']);
		
	/*
	 * Entre ces deux balises vous pourrez mettre votre code specifique a la classe.
	 * Il sera preserve lors de la reconstruction automatique.
	 */
	/*[TAG-getFromTableTile1]*/	/*[/TAG-getFromTableTile1]*/

		}
		if (!empty($listeObjet) && sizeof($listeObjet) == 1) {
			$listeObjet = $listeObjet[0];
		}
		return $listeObjet;
	}

	public static function getFromExtTableCarte($carte=0) {
		//Generated by FactoryGenerator::generateGetFromTableFromFK()
		$listeObjet = array();
		// Lancement de la requete
		$requete = 'SELECT * FROM `tile` ';
		if ($carte == 0) {
			$requete .= 'WHERE carte > 0 ORDER BY id ASC';
		} else {
			$requete .= 'WHERE carte = :carte ORDER BY id ASC';
			//Il faut que le parametre soit dans un array pour le BIND
			$carte = array(':carte' => $carte);
		}
		database::getInstance() -> prepareRequete($requete);
		if (is_array($carte) || $carte > 0) {
			database::getInstance() -> bind($carte);
		}
		if (! database::getInstance() -> executeRequete()) {
			throw new Exception(__CLASS__.'::'.__FUNCTION__.'(): Impossible de lire la table tile');
		}
		// Recuperation des donnees
		$datas = database::getInstance() -> getTableauResultat();
		// Traitement des donnees
		foreach ($datas AS $data) {
			$listeObjet[] = new Tile($data['id'],$data['carte'],$data['x'],$data['y'],$data['vision'],$data['unite'],$data['unite_joueur'],$data['decor'],$data['equipement'],$data['equipement_joueur'],$data['etatCase'],$data['bloque'],$data['tile']);
		}
		if (sizeof($listeObjet) == 1) {
			$listeObjet = $listeObjet[0];
		}
		return $listeObjet;
	}

	public static function getFromExtTableUnite($unite=0) {
		//Generated by FactoryGenerator::generateGetFromTableFromFK()
		$listeObjet = array();
		// Lancement de la requete
		$requete = 'SELECT * FROM `tile` ';
		if ($unite == 0) {
			$requete .= 'WHERE unite > 0 ORDER BY id ASC';
		} else {
			$requete .= 'WHERE unite = :unite ORDER BY id ASC';
			//Il faut que le parametre soit dans un array pour le BIND
			$unite = array(':unite' => $unite);
		}
		database::getInstance() -> prepareRequete($requete);
		if (is_array($unite) || $unite > 0) {
			database::getInstance() -> bind($unite);
		}
		if (! database::getInstance() -> executeRequete()) {
			throw new Exception(__CLASS__.'::'.__FUNCTION__.'(): Impossible de lire la table tile');
		}
		// Recuperation des donnees
		$datas = database::getInstance() -> getTableauResultat();
		// Traitement des donnees
		foreach ($datas AS $data) {
			$listeObjet[] = new Tile($data['id'],$data['carte'],$data['x'],$data['y'],$data['vision'],$data['unite'],$data['unite_joueur'],$data['decor'],$data['equipement'],$data['equipement_joueur'],$data['etatCase'],$data['bloque'],$data['tile']);
		}
		if (sizeof($listeObjet) == 1) {
			$listeObjet = $listeObjet[0];
		}
		return $listeObjet;
	}

	public static function getFromExtTableUnite_joueur($unite_joueur=0) {
		//Generated by FactoryGenerator::generateGetFromTableFromFK()
		$listeObjet = array();
		// Lancement de la requete
		$requete = 'SELECT * FROM `tile` ';
		if ($unite_joueur == 0) {
			$requete .= 'WHERE unite_joueur > 0 ORDER BY id ASC';
		} else {
			$requete .= 'WHERE unite_joueur = :unite_joueur ORDER BY id ASC';
			//Il faut que le parametre soit dans un array pour le BIND
			$unite_joueur = array(':unite_joueur' => $unite_joueur);
		}
		database::getInstance() -> prepareRequete($requete);
		if (is_array($unite_joueur) || $unite_joueur > 0) {
			database::getInstance() -> bind($unite_joueur);
		}
		if (! database::getInstance() -> executeRequete()) {
			throw new Exception(__CLASS__.'::'.__FUNCTION__.'(): Impossible de lire la table tile');
		}
		// Recuperation des donnees
		$datas = database::getInstance() -> getTableauResultat();
		// Traitement des donnees
		foreach ($datas AS $data) {
			$listeObjet[] = new Tile($data['id'],$data['carte'],$data['x'],$data['y'],$data['vision'],$data['unite'],$data['unite_joueur'],$data['decor'],$data['equipement'],$data['equipement_joueur'],$data['etatCase'],$data['bloque'],$data['tile']);
		}
		if (sizeof($listeObjet) == 1) {
			$listeObjet = $listeObjet[0];
		}
		return $listeObjet;
	}

	public static function getFromExtTableDecor($decor=0) {
		//Generated by FactoryGenerator::generateGetFromTableFromFK()
		$listeObjet = array();
		// Lancement de la requete
		$requete = 'SELECT * FROM `tile` ';
		if ($decor == 0) {
			$requete .= 'WHERE decor > 0 ORDER BY id ASC';
		} else {
			$requete .= 'WHERE decor = :decor ORDER BY id ASC';
			//Il faut que le parametre soit dans un array pour le BIND
			$decor = array(':decor' => $decor);
		}
		database::getInstance() -> prepareRequete($requete);
		if (is_array($decor) || $decor > 0) {
			database::getInstance() -> bind($decor);
		}
		if (! database::getInstance() -> executeRequete()) {
			throw new Exception(__CLASS__.'::'.__FUNCTION__.'(): Impossible de lire la table tile');
		}
		// Recuperation des donnees
		$datas = database::getInstance() -> getTableauResultat();
		// Traitement des donnees
		foreach ($datas AS $data) {
			$listeObjet[] = new Tile($data['id'],$data['carte'],$data['x'],$data['y'],$data['vision'],$data['unite'],$data['unite_joueur'],$data['decor'],$data['equipement'],$data['equipement_joueur'],$data['etatCase'],$data['bloque'],$data['tile']);
		}
		if (sizeof($listeObjet) == 1) {
			$listeObjet = $listeObjet[0];
		}
		return $listeObjet;
	}

	public static function getFromExtTableEquipement($equipement=0) {
		//Generated by FactoryGenerator::generateGetFromTableFromFK()
		$listeObjet = array();
		// Lancement de la requete
		$requete = 'SELECT * FROM `tile` ';
		if ($equipement == 0) {
			$requete .= 'WHERE equipement > 0 ORDER BY id ASC';
		} else {
			$requete .= 'WHERE equipement = :equipement ORDER BY id ASC';
			//Il faut que le parametre soit dans un array pour le BIND
			$equipement = array(':equipement' => $equipement);
		}
		database::getInstance() -> prepareRequete($requete);
		if (is_array($equipement) || $equipement > 0) {
			database::getInstance() -> bind($equipement);
		}
		if (! database::getInstance() -> executeRequete()) {
			throw new Exception(__CLASS__.'::'.__FUNCTION__.'(): Impossible de lire la table tile');
		}
		// Recuperation des donnees
		$datas = database::getInstance() -> getTableauResultat();
		// Traitement des donnees
		foreach ($datas AS $data) {
			$listeObjet[] = new Tile($data['id'],$data['carte'],$data['x'],$data['y'],$data['vision'],$data['unite'],$data['unite_joueur'],$data['decor'],$data['equipement'],$data['equipement_joueur'],$data['etatCase'],$data['bloque'],$data['tile']);
		}
		if (sizeof($listeObjet) == 1) {
			$listeObjet = $listeObjet[0];
		}
		return $listeObjet;
	}

	public static function getFromExtTableEquipement_joueur($equipement_joueur=0) {
		//Generated by FactoryGenerator::generateGetFromTableFromFK()
		$listeObjet = array();
		// Lancement de la requete
		$requete = 'SELECT * FROM `tile` ';
		if ($equipement_joueur == 0) {
			$requete .= 'WHERE equipement_joueur > 0 ORDER BY id ASC';
		} else {
			$requete .= 'WHERE equipement_joueur = :equipement_joueur ORDER BY id ASC';
			//Il faut que le parametre soit dans un array pour le BIND
			$equipement_joueur = array(':equipement_joueur' => $equipement_joueur);
		}
		database::getInstance() -> prepareRequete($requete);
		if (is_array($equipement_joueur) || $equipement_joueur > 0) {
			database::getInstance() -> bind($equipement_joueur);
		}
		if (! database::getInstance() -> executeRequete()) {
			throw new Exception(__CLASS__.'::'.__FUNCTION__.'(): Impossible de lire la table tile');
		}
		// Recuperation des donnees
		$datas = database::getInstance() -> getTableauResultat();
		// Traitement des donnees
		foreach ($datas AS $data) {
			$listeObjet[] = new Tile($data['id'],$data['carte'],$data['x'],$data['y'],$data['vision'],$data['unite'],$data['unite_joueur'],$data['decor'],$data['equipement'],$data['equipement_joueur'],$data['etatCase'],$data['bloque'],$data['tile']);
		}
		if (sizeof($listeObjet) == 1) {
			$listeObjet = $listeObjet[0];
		}
		return $listeObjet;
	}

	public static function getFromExtTableTile($tile=0) {
		//Generated by FactoryGenerator::generateGetFromTableFromFK()
		$listeObjet = array();
		// Lancement de la requete
		$requete = 'SELECT * FROM `tile` ';
		if ($tile == 0) {
			$requete .= 'WHERE tile > 0 ORDER BY id ASC';
		} else {
			$requete .= 'WHERE tile = :tile ORDER BY id ASC';
			//Il faut que le parametre soit dans un array pour le BIND
			$tile = array(':tile' => $tile);
		}
		database::getInstance() -> prepareRequete($requete);
		if (is_array($tile) || $tile > 0) {
			database::getInstance() -> bind($tile);
		}
		if (! database::getInstance() -> executeRequete()) {
			throw new Exception(__CLASS__.'::'.__FUNCTION__.'(): Impossible de lire la table tile');
		}
		// Recuperation des donnees
		$datas = database::getInstance() -> getTableauResultat();
		// Traitement des donnees
		foreach ($datas AS $data) {
			$listeObjet[] = new Tile($data['id'],$data['carte'],$data['x'],$data['y'],$data['vision'],$data['unite'],$data['unite_joueur'],$data['decor'],$data['equipement'],$data['equipement_joueur'],$data['etatCase'],$data['bloque'],$data['tile']);
		}
		if (sizeof($listeObjet) == 1) {
			$listeObjet = $listeObjet[0];
		}
		return $listeObjet;
	}


	/*
	 * Entre ces deux balises vous pourrez mettre votre code specifique a la classe.
	 * Il sera preserve lors de la reconstruction automatique.
	 */
	/*[TAG-Tile21]*/
	
	/**
	 * Retourne la case par ses coordonnees x/y
	 * @param unknown $idCarte
	 * @param number $x
	 * @param number $y
	 * @throws Exception
	 * @return Ambigous <multitype:, Tile>
	 */
	public static function getCaseFromCoordonate($idCarte,$x=0,$y=0) {
		$oCase = array();
		/* Lancement de la requete */
		$requete = 'SELECT * FROM tile WHERE carte = '.$idCarte.' AND x = '.$x.' AND y = '.$y;
		if (! database::getInstance() -> executeRequete($requete)) {
			throw new Exception('Impossible de lire la table tile');
		}
		/* Recuperation des donnees */
		$datas = database::getInstance() -> getTableauResultat();
		/* Traitement des donnees */
		foreach ($datas AS $data) {
			$oCase = new Tile($data['id'],$data['carte'],$data['x'],$data['y'],$data['vision'],$data['unite'],$data['unite_joueur'],$data['decor'],$data['equipement'],$data['equipement_joueur'],$data['etatCase'],$data['bloque'],$data['tile']);
		}
		return $oCase;
	}
	
	
	/**
	 * Retourne la liste des cases occupees dans la limite des donnees transmises
	 * @param unknown $idCarte
	 * @param number $xMin
	 * @param number $xMax
	 * @param number $yMin
	 * @param number $yMax
	 * @throws Exception
	 * @return multitype:Tile
	 */
	public static function getBusyCasesCarteFromRange($idCarte,$xMin=0,$xMax=0,$yMin=0,$yMax=0) {
		$listeObjet = array();
		/* Lancement de la requete */
		$requete = 'SELECT *  FROM tile WHERE carte = :carte';
		if ($xMax>0 && $yMax>0) {
			$requete .= ' AND (:xmin <= x AND x <= :xmax)';
			$requete .= ' AND (:ymin <= y and y <= :ymax)';
		}
		$requete .= ' AND (unite <> 0 OR unite_joueur <> 0)';

		database::getInstance()->prepareRequete($requete);
		database::getInstance()->bind(array(
											'carte' => $idCarte,
											'xmin' => $xMin,
											'xmax' => $xMax,
											'ymin' => $yMin,
											'ymax' => $yMax));
	
		if (! database::getInstance() -> executeRequete()) {
			throw new Exception('Impossible de lire la table tile');
		}
		/* Recuperation des donnees */
		$datas = database::getInstance() -> getTableauResultat();
		/* Traitement des donnees */
		foreach ($datas AS $data) {
			$listeObjet[] = new Tile($data['id'],$data['carte'],$data['x'],$data['y'],$data['vision'],$data['unite'],$data['unite_joueur'],$data['decor'],$data['etatCase'],$data['bloque'],$data['tile']);
		}
		return $listeObjet;
	}
	
	/**
	 * 
	 * @param unknown $idCarte
	 * @param number $idTile
	 * @param number $xMin
	 * @param number $xMax
	 * @param number $yMin
	 * @param number $yMax
	 * @throws Exception
	 * @return array(Tile) Array of Tiles
	 */
	public static function getEnnemiesCasesFromRange($idCarte,$idTile=0,$xMin=0,$xMax=0,$yMin=0,$yMax=0) {
	    $listeObjet = array();
	    /* Lancement de la requete */
	    $requete = 'SELECT *  FROM tile WHERE carte = :carte';
	    if ($xMax>0 && $yMax>0) {
	        $requete .= ' AND (:xmin <= x AND x <= :xmax)';
	        $requete .= ' AND (:ymin <= y and y <= :ymax)';
	    }
	    $requete .= ' AND id <> :id';
	    $requete .= ' AND (unite <> 0 OR unite_joueur <> 0)';
	    
	    database::getInstance()->prepareRequete($requete);
	    database::getInstance()->bind(array(
	        'carte' => $idCarte,
	        'xmin' => $xMin,
	        'xmax' => $xMax,
	        'ymin' => $yMin,
	        'ymax' => $yMax,
	        'id' => $idTile));
	    
	    if (! database::getInstance() -> executeRequete()) {
	        throw new Exception('Impossible de lire la table tile');
	    }
	    /* Recuperation des donnees */
	    $datas = database::getInstance() -> getTableauResultat();
	    /* Traitement des donnees */
	    foreach ($datas AS $data) {
	        $listeObjet[] = new Tile($data['id'],$data['carte'],$data['x'],$data['y'],$data['vision'],$data['unite'],$data['unite_joueur'],$data['decor'],$data['etatCase'],$data['bloque'],$data['tile']);
	    }
	    return $listeObjet;
	}
	
	/**
	 * Retourne la liste des cases dans la limite des donnees transmises
	 * @param unknown $idCarte
	 * @param number $xMin
	 * @param number $xMax
	 * @param number $yMin
	 * @param number $yMax
	 * @throws Exception
	 * @return multitype:Tile
	 */
	public static function getCasesCarteFromRange($idCarte,$xMin=0,$xMax=0,$yMin=0,$yMax=0) {
		$listeObjet = array();
		/* Lancement de la requete */
		$requete = 'SELECT *';
		$requete .= ' FROM tile';
		$requete .= ' WHERE carte = '.$idCarte;
		if ($xMax>0 && $yMax>0) {
		    $requete .= ' AND (:xmin <= x AND x <= :xmax)';
		    $requete .= ' AND (:ymin <= y and y <= :ymax)';
		}
		database::getInstance()->prepareRequete($requete);
		database::getInstance()->bind(array(
                                		    'carte' => $idCarte,
                                		    'xmin' => $xMin,
                                		    'xmax' => $xMax,
                                		    'ymin' => $yMin,
                                		    'ymax' => $yMax));
		
		if (! database::getInstance() -> executeRequete()) {
			throw new Exception('Impossible de lire la table tile');
		}
		/* Recuperation des donnees */
		$datas = database::getInstance() -> getTableauResultat();
		/* Traitement des donnees */
		foreach ($datas AS $data) {
			$listeObjet[] = new Tile($data['id'],$data['carte'],$data['x'],$data['y'],$data['vision'],$data['unite'],$data['unite_joueur'],$data['decor'],$data['equipement'],$data['equipement_joueur'],$data['etatCase'],$data['bloque'],$data['tile']);
		}
		return $listeObjet;
	}
	
	/**
	 * Retourne la liste des cases servant de lien sur la carte donnee en parametre
	 * @param unknown $idCarte
	 * @throws Exception
	 * @return multitype:Tile
	 */
	public static function getListeCasesLienFromCarte($idCarte) {
		$listeObjet = array();
		/* Lancement de la requete */
		$requete = 'SELECT * FROM tile';
		$requete .= ' WHERE carte = '.$idCarte;
		$requete .= ' AND etatCase = :etatCase';
		
		database::getInstance()->prepareRequete($requete);
		database::getInstance()->bind(array('etatCase' => _CASE_LIEN_));
	
		if (! database::getInstance() -> executeRequete()) {
			throw new Exception('Impossible de lire la table tile');
		}
		/* Recuperation des donnees */
		$datas = database::getInstance() -> getTableauResultat();
		/* Traitement des donnees */
		foreach ($datas AS $data) {
			$listeObjet[] = new Tile($data['id'],$data['carte'],$data['x'],$data['y'],$data['vision'],$data['unite'],$data['unite_joueur'],$data['decor'],$data['equipement'],$data['equipement_joueur'],$data['etatCase'],$data['bloque'],$data['tile']);
		}
		return $listeObjet;
	}
	
	
	/**
	 * Retourne un objet Tile vide
	 * @return Tile
	 */
	public static function getCaseVide() {
		return new Tile();
	}
	
	public static function getFreeTilesList($idCarte) {
		$listeObjet = array();
		$requete = "SELECT * FROM tile";
		$requete .= " WHERE carte = :idcarte";
		$requete .= " AND bloque = 0";	//case non bloquee
		$requete .= " AND (etatCase > 0 AND etatCase < 3) ";	//case plateau ou plateau + decor
		$requete .= " AND unite = 0 AND unite_joueur = 0";		//pas d'unité
		
		database::getInstance() -> prepareRequete($requete);
		database::getInstance() -> bind(array('idcarte' => $idCarte));
	
		if (! database::getInstance() -> executeRequete()) {
			throw new Exception('Impossible de lire la table tile');
		}
		/* Recuperation des donnees */
		$datas = database::getInstance() -> getTableauResultat();
		/* Traitement des donnees */
		foreach ($datas AS $data) {
			$listeObjet[] = new Tile($data['id'],$data['carte'],$data['x'],$data['y'],$data['vision'],$data['unite'],$data['unite_joueur'],$data['decor'],$data['equipement'],$data['equipement_joueur'],$data['etatCase'],$data['bloque'],$data['tile']);
		}
		return $listeObjet;
	}
	
	/*[/TAG-Tile21]*/


}
?>